<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>StockPage JS Attempt2</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>




</head>

<body>
    <form>
        <input type="text" placeholder="Date" id="Date">
        <input type="text" placeholder="Stock 1" id="s1">
        <input type="text" placeholder="Stock 2" id="s2">

        <button type="button" onclick="getInputValue(); ">Submit</button>
    </form>

    <div><canvas id="myChart"></canvas></div>

    <script>
        var dates = [];
        var closes1 = [];
        var closes2 = [];
        var infoStored;

        function getInputValue() {
            // Selecting the input element and get its value 

            var inputDate = "2021-05-14";//document.getElementById("Date").value;
            var inputS1 = "AAPL";//document.getElementById("s1").value;
            var inputS2 = "TSLA";//document.getElementById("s2").value;

            "http://api.marketstack.com/v1/eod?access_key=469ed3642bddff1dee77e5b1332ce3b7&symbols=AAPL,TSLA&date_from=2021-05-14";

            var url1 = "http://api.marketstack.com/v1/eod?access_key=469ed3642bddff1dee77e5b1332ce3b7&symbols=";
            var url2 = "&date_from=";
            var urlTotal = url1.concat(inputS1).concat(",").concat(inputS2).concat(url2).concat(inputDate);


            function callAPIdate(dataArray) {
                var dates = [];
                var closes1 = [];
                var closes2 = [];
                for (let i = 0; i < dataArray.length; i += 2) {
                    closes1.push(dataArray[i].close);
                    dates.push(dataArray[i].date);

                }
                for (let i = 1; i < dataArray.length; i += 2) {
                    closes2.push(dataArray[i].close);

                }
                var combined = [];
                combined.push(dates);
                combined.push(closes1);
                combined.push(closes2);
                return combined;
            }


            function callAPI2(dataArray) {
                var closes2 = []

                for (let i = 0; i < dataArray.length; i++) {
                    closes2.push((dataArray[i].close));
                }
                return (closes2);
            }

            function createChart(closes1, closes2, dates) {
                let myChart = document.getElementById("myChart").getContext("2d");
                new Chart(document.getElementById("myChart"), {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [
                            {
                                label: "Closing Prices for " + inputS1,
                                data: closes1
                            },
                            {
                                label: "Closing Prices for " + inputS2,
                                data: closes2
                            }

                        ]
                    },
                    options: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: inputS1 + " vs " + inputS2

                        }
                    }
                });
            }

            function createChartTest(combinedArray) {
                console.log(combinedArray);
                var dates = combinedArray[0];
                dates = dates.reverse();
                var closes1 = combinedArray[1];
                closes1 = closes1.reverse();
                var closes2 = combinedArray[2];
                closes2 = closes2.reverse();
                let myChart = document.getElementById("myChart").getContext("2d");
                new Chart(document.getElementById("myChart"), {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [
                            {
                                label: "Closing Prices for " + inputS1,
                                data: closes1
                            },
                            {
                                label: "Closing Prices for " + inputS2,
                                data: closes2
                            }


                        ]
                    },
                    options: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: inputS1 + " vs " + inputS2

                        }
                    }
                });
            }

            fetch(urlTotal).then(console.log("check 1"))
                .then((response) => response.json())
                .then((data) => callAPIdate(data.data)).then(tempCombined => createChartTest(tempCombined));
            /*
        }).then(fetch(urlTotal2)).then((response2) => response2.json()).then((data2) => {
            var tempCloses2 = callAPI2(data2.data);
        }).then(createChart(tempCloses1, tempCloses2, tempDates));
        */


        }
    </script>




</body>

</html>