<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>StockPage JS Attempt</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>




</head>

<body>
    <form>
        <input type="text" placeholder="Date" id="Date">
        <input type="text" placeholder="Stock 1" id="s1">
        <input type="text" placeholder="Stock 2" id="s2">

        <button type="button" onclick="getInputValue(); ">Submit</button>
    </form>

    <div><canvas id="myChart"></canvas></div>

    <script>
        function getInputValue() {
            // Selecting the input element and get its value 

            var inputDate = "2021-05-14";//document.getElementById("Date").value;
            var inputS1 = "AAPL";//document.getElementById("s1").value;
            var inputS2 = "TSLA";//document.getElementById("s2").value;
            /*
            var dates = [];
            var closes1 = [];
            var closes2 = [];
            */

            let url1 = "http://api.marketstack.com/v1/eod?access_key=469ed3642bddff1dee77e5b1332ce3b7&symbols=";
            let url2 = "&date_from=";
            let urlTotal = url1.concat(inputS1).concat(url2).concat(inputDate);

            async function callAPI1(url) {
                var tempcloses1 = []
                let response = await fetch(url);
                let text = await response.json();

                let dataArray = text.data;
                for (let i = 0; i < dataArray.length; i++) {
                    tempcloses1.push((dataArray[i].close));



                }
                return tempcloses1;
            }
            closes1 = callAPI1(urlTotal);

            async function callAPIdate(url) {
                var tempdates = []
                let response = await fetch(url);
                let text = await response.json();

                let dataArray = text.data;
                for (let i = 0; i < dataArray.length; i++) {

                    tempdates.push(dataArray[i].date);

                }
                return tempdates;
            }

            dates = callAPIdate(urlTotal);


            let urlTotal2 = url1.concat(inputS2).concat(url2).concat(inputDate);
            async function callAPI2(url) {
                var tempcloses2 = []
                let response = await fetch(url);
                let text = await response.json();

                let dataArray = text.data
                for (let i = 0; i < dataArray.length; i++) {
                    console.log("I = " + i + " " + dataArray[i].close);
                    console.log(typeof (dataArray[i].close));
                    tempcloses2.push((dataArray[i].close));
                    console.log(typeof tempcloses2[i] + " " + tempcloses2[i]);


                }
                console.log("First of closes2 " + typeof tempcloses2[0]);
                return (tempcloses2);

            }

            closes2 = callAPI2(urlTotal2);

            var test = [5, 10, 15];
            console.log("Outside loop " + typeof closes2[0] + " " + closes2[0])


            let myChart = document.getElementById("myChart").getContext("2d");
            new Chart(document.getElementById("myChart"), {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: "Closing Price",
                            data: closes1
                        }
                    ]
                },
                options: {
                    legend: { display: false },
                    title: {
                        display: true,

                    }
                }
            });

        }


    </script>




</body>

</html>